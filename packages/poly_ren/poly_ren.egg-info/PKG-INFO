Metadata-Version: 2.4
Name: poly-ren
Version: 1.0.0
Summary: Renpy-specific text extraction and merging tools for translation workflows
Author: Enro Team
License: MIT
Keywords: renpy,translation,extraction,visual-novel
Classifier: Development Status :: 4 - Beta
Classifier: Intended Audience :: Developers
Classifier: License :: OSI Approved :: MIT License
Classifier: Programming Language :: Python :: 3.9
Classifier: Programming Language :: Python :: 3.10
Classifier: Programming Language :: Python :: 3.11
Classifier: Topic :: Text Processing :: Linguistic
Requires-Python: >=3.9
Description-Content-Type: text/markdown
Requires-Dist: pyyaml>=6.0
Provides-Extra: dev
Requires-Dist: pytest>=7.0; extra == "dev"
Requires-Dist: black>=23.0; extra == "dev"
Requires-Dist: mypy>=1.0; extra == "dev"

# poly_ren

Renpy-specific text extraction and merging tools.

## Description

Handles extraction of translatable text from Renpy game files (.rpy), tag preservation, and merging translated text back into game files.

## Setup

```bash
# Install dependencies
pip install -r ../../requirements.txt

# Or install as package
pip install -e .
```

## Configure

No configuration required. Extraction/merging is file-based.

## Run

### Extract
```bash
# Python CLI
python cli.py extract <input_dir> <output_yaml>

# Or programmatically
from src.poly_ren.extract import RenpyExtractor
extractor = RenpyExtractor()
blocks = extractor.extract_from_directory("game/tl")
```

### Merge
```bash
# Python CLI
python cli.py merge <translation_yaml> <output_dir>

# Or programmatically
from src.poly_ren.merge import RenpyMerger
merger = RenpyMerger()
merger.merge_translations("translations.yaml", "game/tl/language")
```

## Test

```bash
# Run poly_ren tests
pytest ../../tests/test_unit_extract.py
pytest ../../tests/test_unit_merge.py
pytest ../../tests/test_unit_renpy_tags.py
```

## Debug

Check extracted YAML structure or enable verbose output in extractor/merger classes.

# Workflow

  Extract (poly_ren) → Translate (poly_trans) → Merge (poly_ren)
       ↓                      ↓                        ↓
    .parsed.yaml    →   .parsed.yaml (with ro)  →  game.rpy

  It's a YAML-in → translate line-by-line → YAML-out system with smart context extraction and resumability.

    Translation Process

  1. Scans for .parsed.yaml files in the target language directory
  2. Identifies untranslated blocks (where target language field is empty/whitespace)
  3. Extracts context for each block:
    - DIALOGUE blocks: 3 lines before + 1 line after (configurable)
    - CHOICE blocks: No dialogue context (only character info)
  4. Translates each block using the AI model with:
    - The text to translate
    - Surrounding dialogue context
    - Character information
    - Glossary terms
    - Custom prompts
  5. Writes translation back to the same YAML file under the target language code
  6. Saves the updated .parsed.yaml file

  Output Format: Same .parsed.yaml (updated)
